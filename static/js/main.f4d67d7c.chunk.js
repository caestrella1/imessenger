(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{24:function(e,t,a){e.exports=a(50)},49:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var s=a(0),o=a.n(s),n=a(11),r=a.n(n),i=a(16),c=a(3),m=a(4),l=a(6),u=a(5),h=a(2),d=a(7),p=a(14),g=a.n(p),b=a(12),v=a(10),f=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"navbar"},o.a.createElement("h1",{id:"app-title"},o.a.createElement(b.a,{icon:v.a}),"iMessenger"),o.a.createElement("button",{id:"toggle-theme",onClick:this.props.toggleDarkMode},o.a.createElement(b.a,{icon:this.props.isDark?v.d:v.b})))}}]),t}(o.a.Component),j=a(13),y=a.n(j);function E(e){return 0===y.a.withoutEmoji(e).length}var k=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"formatText",value:function(e){return t=e,0===y.a.withoutEmoji(t).length?o.a.createElement("span",{className:"message-emoji"},e):o.a.createElement("div",{className:"message-bubble"},function(e){var t=[],a=y.a.split(e),s=!0,n=!1,r=void 0;try{for(var i,c=a[Symbol.iterator]();!(s=(i=c.next()).done);s=!0){var m=i.value;E(m)?t.push(o.a.createElement("span",{className:"inline-emoji"},m)):t.push(m)}}catch(l){n=!0,r=l}finally{try{s||null==c.return||c.return()}finally{if(n)throw r}}return t}(e));var t}},{key:"render",value:function(){var e=this.props.user.name===this.props.username?"sent":"received";return o.a.createElement("div",{className:"message "+e},o.a.createElement("div",{className:"message-username"},this.props.username),this.formatText(this.props.text),o.a.createElement("div",{className:"message-timestamp"},"Sent ",this.props.sent))}}]),t}(o.a.Component),O=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).getTypingList=e.getTypingList.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"getTypingList",value:function(){var e="";return this.props.usersWhoAreTyping&&(e=this.props.usersWhoAreTyping.map((function(e){return e})).join(", ").replace(/, ([^,]+)$/," and $1"),this.props.usersWhoAreTyping.length>1?e+=" are typing...":e+=" is typing..."),e}},{key:"render",value:function(){return this.props.usersWhoAreTyping.length>0?o.a.createElement("div",{id:"type-bubble",className:"message"},o.a.createElement("div",{className:"user-typing"},this.getTypingList())):null}}]),t}(o.a.Component),R=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"componentWillUpdate",value:function(){var e=r.a.findDOMNode(this);this.shouldScrollToBottom=e.scrollTop+e.clientHeight>=e.scrollHeight}},{key:"componentDidUpdate",value:function(){if(this.shouldScrollToBottom){var e=r.a.findDOMNode(this);e.scrollTop=e.scrollHeight}}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"message-list"},this.props.messages.map((function(t,a){return o.a.createElement(k,{key:a,user:e.props.user,username:t.sender.name,text:t.parts[0].payload.content,sent:t.createdAt})})),o.a.createElement(O,{usersWhoAreTyping:this.props.usersWhoAreTyping}))}}]),t}(o.a.Component),N=(a(47),a(23)),T=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={message:"",isEmojiPickerVisible:!1},e.handleChange=e.handleChange.bind(Object(h.a)(e)),e.handleSubmit=e.handleSubmit.bind(Object(h.a)(e)),e.toggleEmojiPicker=e.toggleEmojiPicker.bind(Object(h.a)(e)),e.addEmojiToMessage=e.addEmojiToMessage.bind(Object(h.a)(e)),e.handleMessageFocus=e.handleMessageFocus.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"handleChange",value:function(e){this.setState({message:e.target.value}),this.props.onChange&&this.props.onChange()}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.sendMessage(this.state.message),this.setState({message:""})}},{key:"handleMessageFocus",value:function(){this.setState({isEmojiPickerVisible:!1})}},{key:"toggleEmojiPicker",value:function(e){e.preventDefault(),this.setState({isEmojiPickerVisible:!this.state.isEmojiPickerVisible})}},{key:"addEmojiToMessage",value:function(e){var t=this.state.message+e.native;this.setState({message:t})}},{key:"render",value:function(){return o.a.createElement("div",{className:"send-message-container"},o.a.createElement("div",{id:"emoji-picker",className:this.state.isEmojiPickerVisible?"show":""},o.a.createElement(N.a,{native:!0,onSelect:this.addEmojiToMessage,title:"Choose an emoji",color:"var(--highlight)",emojiSize:32,emoji:"smile"})),o.a.createElement("button",{id:"toggle-emoji",onClick:this.toggleEmojiPicker},o.a.createElement(b.a,{icon:v.c})),o.a.createElement("form",{onSubmit:this.handleSubmit,className:"send-message"},o.a.createElement("input",{onChange:this.handleChange,onFocus:this.handleMessageFocus,value:this.state.message,placeholder:"Send Message",type:"text"})))}}]),t}(o.a.Component);var M=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).getRoomsList=e.getRoomsList.bind(Object(h.a)(e)),e.getRoomCount=e.getRoomCount.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"getRoomCount",value:function(){return this.props.rooms?this.props.rooms.length+(this.props.rooms.length>1||0===this.props.rooms.length?" Rooms":" Room"):"0 Rooms"}},{key:"getRoomsList",value:function(){var e=this;return this.props.room&&this.props.rooms?this.props.rooms.map((function(t){var a=e.props.room.id===t.id?"active":"",s=t.isPrivate?"Private":"Public",n=t.unreadCount>0?"show":"",r=new Date(t.lastMessageAt);return o.a.createElement("li",{key:t.id,className:"room "+a},o.a.createElement("button",{onClick:function(){return e.props.subscribeToRoom(t.id)}},o.a.createElement("div",{className:"room-meta"},o.a.createElement("span",{className:"room-is-private"},s),o.a.createElement("span",{className:"room-name"},t.name),o.a.createElement("span",{className:"room-last"},function(e,t){var a,s=e-t;if(isNaN(t))return"No messages";if(s<6e4)a="Just now";else if(s<36e5){var o=Math.round(s/6e4);a=o>1?o+" minutes ago":o+" minute ago"}else if(s<864e5){var n=Math.round(s/36e5);a=n>1?n+" hours ago":n+" hour ago"}else if(s<2592e6){var r=Math.round(s/864e5);a=r>1?r+" days ago":r+" day ago"}else if(s<31536e6){var i=Math.round(s/2592e6);a=i>1?i+" months ago":i+" month ago"}else{var c=Math.round(s/31536e6);a=c>1?c+" years ago":c+" year ago"}return a}(new Date,r))),o.a.createElement("div",{className:"room-unread "+n},t.unreadCount)))})):null}},{key:"render",value:function(){return o.a.createElement("div",{className:"rooms"},o.a.createElement("div",{className:"room-header"},o.a.createElement("div",null,o.a.createElement("h1",{className:"room-title"},"Room List"),o.a.createElement("span",{className:"room-count"},this.getRoomCount()))),o.a.createElement("ul",{className:"room-list"},this.getRoomsList()))}}]),t}(o.a.Component),S=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"getUsers",value:function(){var e=Object.values(this.props.room.users),t=this.props.user.name,a=new RegExp(t,"g");return e.map((function(e){return e.name})).join(", ").replace(a,"You").replace(/, ([^,]+)$/," and $1")}},{key:"render",value:function(){var e=this;return this.props.room?o.a.createElement("div",{className:"room-info"},o.a.createElement("div",{className:"room-name-users"},o.a.createElement("h1",{className:"room-title"},this.props.room.name),o.a.createElement("span",{className:"user-list"},this.getUsers())),o.a.createElement("div",{className:"room-actions"},o.a.createElement("button",{className:"room-delete",type:"submit",onClick:function(){return e.props.deleteRoom(e.props.room.id)}},"Delete Room"))):o.a.createElement("div",{className:"room-info"},o.a.createElement("div",{className:"room-name-users"},o.a.createElement("h1",{className:"room-title"},"No Room Selected"),o.a.createElement("span",{className:"user-list"},"Please select a room to get started")))}}]),t}(o.a.Component),C=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={roomName:""},e.handleChange=e.handleChange.bind(Object(h.a)(e)),e.handleSubmit=e.handleSubmit.bind(Object(h.a)(e)),e.handleInput=e.handleInput.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"handleChange",value:function(e){this.setState({roomName:e.target.value})}},{key:"handleInput",value:function(){0===document.getElementById("room-input").value.length?document.getElementById("add-room").disabled=!0:document.getElementById("add-room").disabled=!1}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.createRoom(this.state.roomName),this.setState({roomName:""}),document.getElementById("add-room").disabled=!0}},{key:"render",value:function(){return o.a.createElement("form",{className:"new-room",onSubmit:this.handleSubmit},o.a.createElement("input",{id:"room-input",type:"text",value:this.state.roomName,placeholder:"New Room",onInput:this.handleInput,onChange:this.handleChange}),o.a.createElement("button",{id:"add-room",type:"submit",disabled:!0},o.a.createElement("span",{className:"plus"},"+")))}}]),t}(o.a.Component),D=(a(49),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={user:null,room:null,rooms:null,messages:[],usersWhoAreTyping:[],isDark:!1},e.createRoom=e.createRoom.bind(Object(h.a)(e)),e.subscribeToRoom=e.subscribeToRoom.bind(Object(h.a)(e)),e.getSortedRooms=e.getSortedRooms.bind(Object(h.a)(e)),e.deleteRoom=e.deleteRoom.bind(Object(h.a)(e)),e.sendTypingEvent=e.sendTypingEvent.bind(Object(h.a)(e)),e.markMessageAsRead=e.markMessageAsRead.bind(Object(h.a)(e)),e.sendMessage=e.sendMessage.bind(Object(h.a)(e)),e.toggleDarkMode=e.toggleDarkMode.bind(Object(h.a)(e)),e}return Object(d.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;new g.a.ChatManager({instanceLocator:"v1:us1:07629a7c-aaa7-485f-9de5-e10358252138",userId:"carlos",tokenProvider:new g.a.TokenProvider({url:"https://us1.pusherplatform.io/services/chatkit_token_provider/v1/07629a7c-aaa7-485f-9de5-e10358252138/token"})}).connect().then((function(t){e.setState({user:t}),e.state.user&&(e.getSortedRooms(),e.subscribeToRoom(e.state.rooms[0].id))})).catch((function(e){return console.log("error connecting to current user",e)}))}},{key:"createRoom",value:function(e){var t=this;this.state.user.createRoom({name:e}).then((function(e){return t.subscribeToRoom(e.id)})).catch((function(e){return console.log("error creating room",e)}))}},{key:"subscribeToRoom",value:function(e){var t=this;if(!this.state.room||this.state.room.id!==e){this.setState({messages:[]});var a=!0;this.state.user.subscribeToRoomMultipart({roomId:e,hooks:{onMessage:function(s){(a&&e===s.room.id||!a&&t.state.room.id===s.room.id)&&(t.setState({messages:[].concat(Object(i.a)(t.state.messages),[s])}),t.markMessageAsRead(a?e:t.state.room.id,s)),t.getSortedRooms()},onUserStartedTyping:function(e){t.setState({usersWhoAreTyping:[].concat(Object(i.a)(t.state.usersWhoAreTyping),[e.name])})},onUserStoppedTyping:function(e){t.setState({usersWhoAreTyping:t.state.usersWhoAreTyping.filter((function(t){return t!==e.name}))})}}}).then((function(e){t.setState({room:e}),a=!1})).catch((function(e){return console.log("Error subscribing to room",e)}))}}},{key:"getSortedRooms",value:function(){var e=this.state.user.rooms.sort((function(e,t){return new Date(t.lastMessageAt)-new Date(e.lastMessageAt)}));this.setState({rooms:e})}},{key:"deleteRoom",value:function(e){var t=this;this.state.user.deleteRoom({roomId:e}).then((function(){t.subscribeToRoom(t.state.user.rooms[0].id),console.log("Deleted room with ID: ".concat(e))})).catch((function(t){console.log("Error deleted room ".concat(e,": ").concat(t))}))}},{key:"sendTypingEvent",value:function(){this.state.user.isTypingIn({roomId:this.state.room.id}).catch((function(e){return console.error("error",e)}))}},{key:"markMessageAsRead",value:function(e,t){e===t.room.id&&this.state.user.setReadCursor({roomId:e,position:t.id})}},{key:"sendMessage",value:function(e){this.state.user.sendMessage({text:e,roomId:this.state.room.id})}},{key:"toggleDarkMode",value:function(){this.setState({isDark:!this.state.isDark})}},{key:"render",value:function(){return this.state.user?o.a.createElement("div",{id:"app",className:"app "+(this.state.isDark?"dark":"light")},o.a.createElement(f,{toggleDarkMode:this.toggleDarkMode}),o.a.createElement(M,{room:this.state.room,rooms:this.state.rooms,subscribeToRoom:this.subscribeToRoom}),o.a.createElement(S,{user:this.state.user,room:this.state.room,deleteRoom:this.deleteRoom}),o.a.createElement(R,{user:this.state.user,room:this.state.room,messages:this.state.messages,usersWhoAreTyping:this.state.usersWhoAreTyping}),o.a.createElement(T,{currentRoom:this.state.room,sendMessage:this.sendMessage,onChange:this.sendTypingEvent}),o.a.createElement(C,{createRoom:this.createRoom})):null}}]),t}(o.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[24,1,2]]]);
//# sourceMappingURL=main.f4d67d7c.chunk.js.map